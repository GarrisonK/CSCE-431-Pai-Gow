<html>

	<head>
		<script src="/socket.io/socket.io.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="style.css">
	</head>

	<title>Pai Gow</title>

	<body>

		<script>

			var socket = io.connect();
			var wallet = 0;
			var bet = 0;
			var game = new Object();
			game['wallet'] = 0;
			game['bet'] = 0;
			game['minimumBet'] = 0;
			game['betsLocked'] = false;
			game['state'] = "pregame";
			game['stateChangeTime'] = 10000;
			game['lastStateChange'] = 0;
			game['banker'] = -1;

			var updateGameInfo = function(){
				var d = new Date();
				var t = (game.stateChangeTime-(d.getTime()-game.lastStateChange))
				t=t/1000;
				if(t<0){
					t = 0;
				}
				$("#gameInformation").empty();
	    		$("#gameInformation").html("Seconds remaining: "+t+"<br>Game state: "+game.state+"<br>Current bet: $"+game.bet+"<br>Wallet: $"+game.wallet);
			}

			$(function(){	//document is ready
				socket.on('connection acknowledgment',function(wallet,bet,time){
					game.lastStateChange = time;
					game.bet = bet;
					game.minimumBet = bet;
					game.wallet = wallet;
    				$("#messages").prepend("<li>Got a connection from the server</li>");
    				updateGameInfo();
    			});
    			socket.on('bet lock confirm',function(bet){
    				$("#messages").prepend("<li>Server confirms bet lock at $"+bet+"</li>");
    			});
    			socket.on('bet unlock confirm',function(){
    				$("#messages").prepend("<li>Server confirms bet unlock.</li>");
    			});
    			socket.on('game state change',function(state,time){
    				game.state = state;
    				if(state == "dealing" && !game.betsLocked){
    					socket.emit("bet locked",game.bet);
    					game.betsLocked = true;
    				}
    				if(state == "pregame"){
    					game.bet = game.minimumBet;
    				}
    				game.lastStateChange = time;
    				updateGameInfo();
    				$("#messages").prepend("<li>Game state changed to "+state+"</li>");
    			});

    			socket.on('player dealt',function(tile){
    				$("#messages").prepend("<li>Player dealt tile "+tile+"</li>");
    			});

    			setInterval(function(){
    				updateGameInfo();
    			},1);



				//button click listeners
				$("#lockBet").click(function(){
					if(game.state != "betting"){
						return;
					}
					if(!game.betsLocked){
    					socket.emit("bet locked",game.bet);
    					game.betsLocked = true;
    				}
    			});

    			$("#unlockBet").click(function(){
    				if(game.state != "betting"){
    					return;
    				}
    				if(game.betsLocked){
    					game.betsLocked = false;
    					socket.emit("bet unlocked");
    				}
    			});

    			$("#bet5").click(function(){
    				if(game.betsLocked || game.state != "betting"){
    					return;
    				}
    				if(game.wallet >= game.bet+5){
    					game.bet = game.bet+5;
    				}
    				updateGameInfo();
    			});
    			$("#bet10").click(function(){
    				if(game.betsLocked || game.state != "betting"){
    					return;
    				}
    				if(game.wallet >= game.bet+10){
    					game.bet = game.bet+10;
    				}
    				updateGameInfo();
    			});
    			$("#bet25").click(function(){
    				if(game.betsLocked || game.state != "betting"){
    					return;
    				}
    				if(game.wallet >= game.bet+25){
    					game.bet = game.bet+25;
    				}
    				updateGameInfo();
    			});


			});

		</script>

		<div id="container">
			<div id="topbar"></div>
			<div id="leftbar"></div>
			<div id="gamewindow">
				<div id="buttons">
					<div id="betting Buttons">
						<button id="bet5">Bet $5</button>
						<button id="bet10">Bet $10</button>
						<button id="bet25">Bet $25</button>
						<button id="lockBet">Lock bet</button>
						<button id="unlockBet">Unlock bet</button>
					</div>
					<div id="tileButtons">
						<button id="lockPair">Lock Selection</button>
						<button id="unlockPair">Unock Selection</button>
					</div>
					<div id="miscButtons">
						<button id="quit">Quit</button>
					</div>
					<div id="gameInformation">
						
					</div>
				</div>
				<div>
					<ul id="messages">

					</ul>
				</div>

			</div>
			<div id="rightbar"></div>
		</div>

	</body>



</html>